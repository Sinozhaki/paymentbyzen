<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Zen</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Mono:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
        }
        .toast {
            visibility: hidden; min-width: 250px; margin-left: -125px;
            color: #fff; text-align: center; border-radius: 8px;
            padding: 16px; position: fixed; z-index: 100;
            left: 50%; bottom: 30px; opacity: 0;
            transition: visibility 0s, opacity 0.5s linear;
        }
        .toast.show { visibility: visible; opacity: 1; }
        .toggle-claim:checked ~ .dot { transform: translateX(100%); background-color: #3b82f6; }
        .toggle-claim:checked ~ .block { background-color: #bfdbfe; }
        .modal-content { transition: transform 0.3s ease-out, opacity 0.3s ease-out; }
        
        @keyframes pulse-dot {
          0%, 100% { transform: scale(1); opacity: 1; }
          50% { transform: scale(0.8); opacity: 0.7; }
        }
        .animate-pulse-dot { animation: pulse-dot 1.2s infinite ease-in-out; }
        .animate-pulse-dot:nth-child(2) { animation-delay: 0.2s; }
        .animate-pulse-dot:nth-child(3) { animation-delay: 0.4s; }

        #gajiModal .modal-content { transform-style: preserve-3d; transform: rotateY(-70deg); }
        #gajiModal.show .modal-content { transform: rotateY(0); }
        .gaji-details > * { opacity: 0; transform: translateY(20px); animation: fadeInUp 0.5s ease-out forwards; }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

        @keyframes shine-effect {
            0% { transform: translateX(-200%) skewX(-25deg); opacity: 0.5; }
            100% { transform: translateX(200%) skewX(-25deg); opacity: 1; }
        }
        .shiny-card { position: relative; overflow: hidden; }
        .shiny-card::before {
            content: ''; position: absolute; top: 0; left: 0;
            width: 70%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shine-effect 3s infinite;
        }
        
        .card-green { background-image: linear-gradient(to bottom right, #15803d, #052e16); }
        .card-gold { background-image: linear-gradient(to bottom right, #facc15, #b45309); }
        .card-red { background-image: linear-gradient(to bottom right, #dc2626, #7f1d1d); }
        .card-default { background-image: linear-gradient(to bottom right, #1f2937, #000000); }

        @keyframes fall { 0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(110vh) rotate(360deg); opacity: 0; } }
        .dollar-sign { position: absolute; top: -10%; color: #fbbF24; font-size: 1.5rem; animation: fall linear infinite; user-select: none; pointer-events: none; }
        
        #withdrawModal .modal-content { transform: translateY(100%); }
        #withdrawModal.show .modal-content { transform: translateY(0); }
        .form-group { position: relative; opacity: 0; transform: translateY(20px); animation: fadeInUp 0.5s ease-out forwards; }
        .form-input { width: 100%; border: 1px solid #d1d5db; border-radius: 0.5rem; outline: 0; font-size: 1rem; color: #111827; padding: 1rem 1rem 1rem 2.75rem; background-color: #f9fafb; transition: border-color 0.2s; }
        .form-input:focus { border-color: #3b82f6; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.4); }
        .form-label { position: absolute; left: 2.75rem; top: 50%; transform: translateY(-50%); display: block; transition: all 0.2s ease-in-out; font-size: 1rem; color: #6b7280; pointer-events: none; }
        .form-input:focus ~ .form-label, .form-input:not(:placeholder-shown) ~ .form-label { top: 0.5rem; transform: translateY(0); font-size: 0.75rem; color: #3b82f6; }
        .form-icon { position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%); color: #9ca3af; transition: color 0.2s; }
        .form-input:focus ~ .form-icon { color: #3b82f6; }

        @keyframes scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        .ticker-wrap {
            position: fixed; top: 0; left: 0; width: 100%;
            z-index: 20; padding: 0.75rem 0;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.8));
            backdrop-filter: blur(4px);
            border-bottom: 1px solid #e5e7eb;
            overflow: hidden;
        }
        .ticker-content { display: flex; white-space: nowrap; animation: scroll 30s linear infinite; }
        .ticker-item { display: flex; align-items: center; padding: 0.25rem 0.75rem; margin-right: 1rem; background-color: #ffffff; border-radius: 9999px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); font-size: 0.8rem; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 overflow-x-hidden">

    <div id="dollarRainContainer" class="fixed inset-0 z-40 pointer-events-none overflow-hidden hidden"></div>

    <div id="withdrawalTicker" class="ticker-wrap"><div id="tickerContent" class="ticker-content"></div></div>

    <div id="app" class="min-h-screen flex flex-col items-center justify-center p-4">
        
        <div class="fixed top-4 right-4 z-30"><button id="infoBtn" class="w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-lg text-gray-600 hover:bg-gray-100 transition-transform duration-150 active:scale-90"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></button></div>

        <div id="loginView" class="w-full max-w-md"><div class="bg-white p-8 rounded-2xl shadow-lg border border-gray-200"><div class="text-center mb-8"><h1 class="text-3xl font-bold text-gray-900">Payment Zen</h1><p class="text-gray-500 mt-2">Masuk dengan akun WhatsApp yang sama saat pertama kali setor Acc.</p></div><form id="loginForm" class="space-y-6"><div><label for="email" class="block text-sm font-medium text-gray-700">Email</label><input type="email" id="email" name="email" required class="mt-1 block w-full px-4 py-3 bg-gray-100 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="anda@email.com"></div><div><label for="whatsapp" class="block text-sm font-medium text-gray-700">Nomor WhatsApp</label><input type="text" id="whatsapp" name="whatsapp" required class="mt-1 block w-full px-4 py-3 bg-gray-100 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="081234567890"></div><div><button type="submit" class="w-full flex justify-center py-3 px-4 border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-transform duration-150 active:scale-95">Log In</button></div></form></div></div>

        <div id="adminView" class="hidden w-full max-w-6xl"><div class="bg-white p-8 rounded-2xl shadow-lg border border-gray-200"> <div class="flex flex-wrap justify-between items-center mb-6 gap-4"><div><h2 class="text-2xl font-bold">Admin Dashboard</h2><p class="text-gray-500">Manajemen data pengguna.</p></div><div class="flex items-center space-x-4"><button id="bulkAddBtn" class="bg-blue-600 text-white text-sm font-medium py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-150">Tambah Masal</button><button id="logoutBtn" class="text-sm font-medium text-blue-600 hover:text-blue-800">Logout</button></div></div> <form id="adminForm" class="mb-8 p-6 bg-gray-50 rounded-lg border border-gray-200"> <h3 id="formTitle" class="text-lg font-semibold mb-4">Tambah Pengguna Baru</h3> <div class="grid grid-cols-1 md:grid-cols-4 gap-4"> <input type="hidden" id="userId"><input id="formEmail" type="email" placeholder="Email" class="w-full px-4 py-2 bg-white rounded-lg" required><input id="formWhatsapp" type="text" placeholder="Nomor WhatsApp" class="w-full px-4 py-2 bg-white rounded-lg" required> <select id="formStatus" class="w-full px-4 py-2 bg-white rounded-lg" required><option value="New Acc">New Acc</option><option value="Restricted">Restricted</option><option value="Unrestricted">Unrestricted</option><option value="Old Acc">Old Acc</option></select> <div class="flex items-center space-x-2"><button type="submit" id="saveBtn" class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700">Simpan</button><button type="button" id="cancelBtn" class="w-full hidden bg-gray-200 text-gray-700 py-2 px-4 rounded-lg">Batal</button></div> </div> </form> <div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Email</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">WhatsApp</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Claimed</th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Actions</th></tr></thead><tbody id="userTableBody" class="bg-white divide-y divide-gray-200"></tbody></table></div></div></div>

        <div class="fixed bottom-4 left-4 z-40"><button id="adminAccessBtn" class="w-10 h-10 bg-gray-800 text-white rounded-full flex items-center justify-center shadow-lg hover:bg-gray-900 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 8a6 6 0 01-7.743 5.743L10 14l-1 1-1 1H6v2H2v-4l4.257-4.257A6 6 0 1118 8zm-6-4a1 1 0 100 2 2 2 0 012 2 1 1 0 102 0 4 4 0 00-4-4z" clip-rule="evenodd" /></svg></button></div>
    </div>
    
    <!-- MODALS -->
    <div id="loader" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden"><div class="flex space-x-2"><div class="w-4 h-4 bg-white rounded-full animate-pulse-dot"></div><div class="w-4 h-4 bg-white rounded-full animate-pulse-dot"></div><div class="w-4 h-4 bg-white rounded-full animate-pulse-dot"></div></div></div>
    <div id="adminModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 hidden"><div class="bg-white p-8 rounded-2xl shadow-lg w-full max-w-sm modal-content transform opacity-0 scale-95"><h3 class="text-xl font-bold text-center mb-4 text-gray-900">Akses Admin</h3><p class="text-gray-500 text-center mb-6">Masukkan kode.</p><form id="adminCodeForm"><input type="password" id="adminCodeInput" class="w-full text-center tracking-widest text-lg px-4 py-3 bg-gray-100 rounded-lg" autofocus><p id="adminError" class="text-red-500 text-xs text-center mt-2 h-4"></p><button type="submit" class="w-full mt-4 py-3 px-4 rounded-lg text-sm font-medium text-white bg-blue-600 hover:bg-blue-700">Masuk</button></form></div></div>
    <div id="confirmModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 hidden"><div class="bg-white p-6 rounded-2xl shadow-lg w-full max-w-sm modal-content transform opacity-0 scale-95"><h3 class="text-lg font-semibold text-gray-900">Konfirmasi Tindakan</h3><p id="confirmMessage" class="text-sm text-gray-600 mt-2 mb-6">Apakah Anda yakin?</p><div class="flex justify-end space-x-3"><button id="confirmCancelBtn" class="px-4 py-2 text-sm font-medium bg-gray-200 rounded-lg hover:bg-gray-300">Batal</button><button id="confirmOkBtn" class="px-4 py-2 text-sm font-medium bg-red-600 text-white rounded-lg hover:bg-red-700">Ya, Hapus</button></div></div></div>
    <div id="gajiModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden" style="perspective: 1000px;"><div class="w-full max-w-md p-6 rounded-2xl shadow-2xl text-white modal-content shiny-card card-default transform opacity-0 scale-95" style="z-index: 51; position: relative;"><div class="flex justify-between items-start"><h3 class="text-xl font-bold text-yellow-300">PAYMENT ZEN</h3><div class="w-12 h-8 bg-black bg-opacity-25 rounded-md flex items-center justify-center"><div class="w-10 h-6 bg-gray-700 rounded-sm"></div></div></div><div class="mt-8 mb-10 text-center gaji-details"><p class="text-gray-300 text-sm" style="animation-delay: 0.3s;">Estimasi Pendapatan</p><p class="text-5xl font-bold mt-2" style="font-family: 'Space Mono', monospace; animation-delay: 0.5s;" id="gajiAmount">$0</p><p class="text-gray-300 text-xs mt-1" style="animation-delay: 0.7s;" id="gajiStatus">Status: -</p></div><div class="flex space-x-3"><button id="gajiLaterBtn" class="w-1/3 bg-gray-600 hover:bg-gray-700 font-bold py-2 px-4 rounded-lg transition-transform duration-150 active:scale-95">Nanti Saja</button><button id="withdrawBtn" class="w-2/3 bg-blue-600 hover:bg-blue-700 font-bold py-2 px-4 rounded-lg transition-transform duration-150 active:scale-95">Withdraw</button></div></div></div>
    <div id="withdrawModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden p-4"><div class="w-full max-w-md bg-white p-8 rounded-2xl shadow-lg modal-content transform opacity-0"><h3 class="text-2xl font-bold text-gray-900 mb-8 text-center">Formulir Withdraw</h3><form id="withdrawForm" class="space-y-8"><div class="form-group relative" style="animation-delay: 0.1s;"><input type="text" id="wdFullName" class="form-input peer" placeholder=" " required><label for="wdFullName" class="form-label">Atas Nama</label><div class="form-icon"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg></div></div><div class="form-group relative" style="animation-delay: 0.2s;"><input type="number" id="wdAccountNumber" class="form-input peer" placeholder=" " required><label for="wdAccountNumber" class="form-label">Nomor Rekening</label><div class="form-icon"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg></div></div><div class="form-group relative" style="animation-delay: 0.3s;"><input type="text" id="wdBankName" class="form-input peer" placeholder=" " required><label for="wdBankName" class="form-label">Nama Bank</label><div class="form-icon"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path></svg></div></div><div class="flex space-x-3 pt-6 form-group" style="animation-delay: 0.4s;"><button type="button" id="withdrawCancelBtn" class="w-1/3 bg-gray-200 hover:bg-gray-300 font-bold py-3 px-4 rounded-lg transition-transform duration-150 active:scale-95">Batal</button><button type="submit" class="w-2/3 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition-transform duration-150 active:scale-95">Ajukan Withdraw</button></div></form></div></div>
    <div id="infoModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden p-4"><div class="w-full max-w-md bg-white p-8 rounded-2xl shadow-lg modal-content transform opacity-0 scale-95"><h3 class="text-2xl font-bold text-gray-900 mb-6 text-center">Informasi Rate</h3><div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status Akun</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Rate Pembayaran</th></tr></thead><tbody class="bg-white divide-y divide-gray-200"><tr><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800">New Acc & Old Acc</td><td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">$10</td></tr><tr><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800">Unrestricted</td><td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">$15</td></tr><tr><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800">Restricted</td><td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">$1</td></tr></tbody></table></div><button id="infoCloseBtn" class="w-full mt-8 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-transform duration-150 active:scale-95">Tutup</button></div></div>
    <div id="claimedModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden p-4"><div class="w-full max-w-sm bg-gradient-to-br from-gray-900 to-gray-800 p-8 rounded-2xl shadow-lg text-white text-center modal-content transform opacity-0 scale-95"><div class="mx-auto bg-red-500/20 rounded-full h-16 w-16 flex items-center justify-center mb-6"><svg class="w-10 h-10 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg></div><h3 class="text-2xl font-bold uppercase mb-3">Sudah di Claim</h3><p class="text-gray-400 text-sm mb-8">Jika Anda merasa belum claim, segera hubungi admin.</p><button id="claimedCloseBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-transform duration-150 active:scale-95">Mengerti</button></div></div>
    
    <div id="bulkAddModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden p-4">
        <div class="w-full max-w-lg bg-white p-8 rounded-2xl shadow-lg modal-content transform opacity-0 scale-95">
            <h3 class="text-2xl font-bold text-gray-900 mb-4">Tambah Pengguna Secara Masal</h3>
            <p class="text-sm text-gray-500 mb-6">Masukkan data dengan format: <code class="bg-gray-100 text-gray-700 px-1 py-0.5 rounded">email@contoh.com 08123456789</code>, satu entri per baris.</p>
            <form id="bulkAddForm">
                <textarea id="bulkData" rows="10" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="Tempel data di sini..."></textarea>
                <div class="mt-4">
                    <label for="bulkStatus" class="block text-sm font-medium text-gray-700">Pilih Status untuk Semua</label>
                    <select id="bulkStatus" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        <option value="New Acc">New Acc</option>
                        <option value="Restricted">Restricted</option>
                        <option value="Unrestricted">Unrestricted</option>
                        <option value="Old Acc">Old Acc</option>
                    </select>
                </div>
                <div class="flex space-x-3 mt-8">
                    <button type="button" id="bulkAddCancelBtn" class="w-1/3 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-4 rounded-lg">Batal</button>
                    <button type="submit" class="w-2/3 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg">Proses & Simpan</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="toast" class="toast"></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const BIN_ID = '68d6119843b1c97be9506c0c', API_KEY = '$2a$10$CyEgkHrw6xtwHt.RE3ZqEulgvcK5yzSmlYJmn.aRA23csA9a8u/.2', API_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`, ADMIN_CODE = '121', ADMIN_WHATSAPP = '62859106914815', SALARIES = {'New Acc':10,'Old Acc':10,'Restricted':1,'Unrestricted':15};
        let users = [], confirmCallback = null, currentUser = null;
        const allModals = {loader:document.getElementById('loader'), toast:document.getElementById('toast'), admin:document.getElementById('adminModal'), confirm:document.getElementById('confirmModal'), gaji:document.getElementById('gajiModal'), withdraw:document.getElementById('withdrawModal'), info:document.getElementById('infoModal'), claimed: document.getElementById('claimedModal'), bulkAdd: document.getElementById('bulkAddModal')};
        const dollarRainContainer = document.getElementById('dollarRainContainer');
        const fetchData=async()=>{try{const r=await fetch(`${API_URL}/latest`,{headers:{'X-Master-Key':API_KEY}});if(!r.ok)throw new Error;const d=await r.json();return users=d.record.users||[]}catch(e){return console.error(e),showToast("Gagal memuat data.","error"),[]}};const updateData=async d=>{try{const r=await fetch(API_URL,{method:"PUT",headers:{"Content-Type":"application/json","X-Master-Key":API_KEY},body:JSON.stringify({users:d})});if(!r.ok)throw new Error;return users=d,renderTable(),!0}catch(e){return console.error(e),showToast("Gagal update data.","error"),!1}};const showView=v=>{document.getElementById("loginView").classList.toggle("hidden","login"!==v),document.getElementById("adminView").classList.toggle("hidden","admin"!==v); const adminAccessBtn = document.getElementById("adminAccessBtn"); if(adminAccessBtn) adminAccessBtn.parentElement.classList.toggle("hidden","admin"===v); document.getElementById("withdrawalTicker").classList.toggle("hidden", "admin"===v)};const showToast=(m,t="success")=>{allModals.toast.textContent=m,allModals.toast.className=`toast show ${"success"===t?"bg-green-500":"bg-red-500"}`,setTimeout(()=>{allModals.toast.className=allModals.toast.className.replace("show","")},3e3)};const showLoader=s=>allModals.loader.classList.toggle("hidden",!s);const renderTable=()=>{const e=document.getElementById("userTableBody");if(e.innerHTML="",0===users.length)return void(e.innerHTML='<tr><td colspan="5" class="text-center py-4 text-gray-500">Tidak ada data.</td></tr>');users.forEach(t=>{const s=document.createElement("tr");s.innerHTML=`<td class="px-6 py-4 text-sm text-gray-900">${t.email}</td><td class="px-6 py-4 text-sm text-gray-500">${t.whatsapp}</td><td class="px-6 py-4"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusColor(t.status)}">${t.status}</span></td><td class="px-6 py-4 text-sm"><label class="flex items-center cursor-pointer"><div class="relative"><input type="checkbox" class="sr-only toggle-claim" data-id="${t.id}" ${t.claimed?"checked":""}> <div class="block bg-gray-200 w-10 h-6 rounded-full"></div><div class="dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition"></div></div></label></td><td class="px-6 py-4 text-right text-sm font-medium"><button class="edit-btn text-blue-600 hover:text-blue-900 mr-4" data-id="${t.id}">Edit</button><button class="delete-btn text-red-600 hover:text-red-900" data-id="${t.id}">Hapus</button></td>`,e.appendChild(s)})};const getStatusColor=s=>({"New Acc":"bg-blue-100 text-blue-800",Restricted:"bg-yellow-100 text-yellow-800",Unrestricted:"bg-green-100 text-green-800","Old Acc":"bg-gray-100 text-gray-800"})[s]||"bg-gray-100 text-gray-800";const resetAdminForm=()=>{document.getElementById("adminForm").reset(),document.getElementById("userId").value="",document.getElementById("formTitle").textContent="Tambah Pengguna Baru",document.getElementById("saveBtn").textContent="Simpan",document.getElementById("cancelBtn").classList.add("hidden")};
        const openModal=(m)=>{m.classList.remove("hidden"),setTimeout(()=>{m.classList.add("show"),m.querySelector(".modal-content").classList.remove("opacity-0","scale-95"),"withdrawModal"===m.id&&m.querySelector(".modal-content").classList.remove("translate-y-full")},10)};const closeModal=m=>{m.classList.remove("show");const e=m.querySelector(".modal-content");e.classList.add("opacity-0"),"withdrawModal"===m.id?e.classList.add("translate-y-full"):e.classList.add("scale-95"),"gajiModal"===m.id&&(dollarRainContainer.classList.add("hidden"),dollarRainContainer.innerHTML=""),setTimeout(()=>m.classList.add("hidden"),300)};
        const showConfirmModal=(m,c)=>{document.getElementById("confirmMessage").textContent=m,confirmCallback=c,openModal(allModals.confirm)};const createDollarRain=()=>{dollarRainContainer.innerHTML="",dollarRainContainer.classList.remove("hidden");for(let e=0;e<40;e++){const t=document.createElement("div");t.classList.add("dollar-sign"),t.textContent="$",t.style.left=100*Math.random()+"vw",t.style.animationDuration=2*Math.random()+3+"s",t.style.animationDelay=4*Math.random()+"s",t.style.fontSize=1*Math.random()+.8+"rem",t.style.opacity=.5*Math.random()+.5,dollarRainContainer.appendChild(t)}};
        const generateTicker=()=>{const e=["Hansinozhaki@gmail.com","Jexecaa@gmail.com","Bukalapaakk@gmail.com","Gerryanvd@gmail.com","UserTest@email.com","PaymentPro@mail.com"],t=[1,10,15],a=document.getElementById("tickerContent"),l=e=>`<div class="ticker-item"><svg class="w-4 h-4 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="text-gray-600">${e.split("@")[0]}... baru saja withdraw <strong class="text-gray-800 ml-1">$${t[Math.floor(Math.random()*t.length)]}</strong></span></div>`,d=e.map(l).join("");a.innerHTML=d+d};
        
        generateTicker();
        document.getElementById('loginForm').addEventListener('submit', async(e)=>{e.preventDefault();const t=e.target,a=t.email.value,l=t.whatsapp.value;showLoader(!0),await fetchData();const d=users.find(e=>e.email?.trim().toLowerCase()===a.trim().toLowerCase()&&e.whatsapp?.trim().toLowerCase()===l.trim().toLowerCase());d?d.claimed?setTimeout(()=>{showLoader(!1),openModal(allModals.claimed),t.reset()},500):(currentUser=d,setTimeout(()=>{showLoader(!1),createDollarRain();const e=SALARIES[d.status]||0,a=document.querySelector("#gajiModal .modal-content");a.className="w-full max-w-md p-6 rounded-2xl shadow-2xl text-white modal-content shiny-card transform opacity-0 scale-95";const l={"New Acc":"card-green","Old Acc":"card-green",Unrestricted:"card-gold",Restricted:"card-red"}[d.status]||"card-default";a.classList.add(l),document.getElementById("gajiAmount").textContent=`$${e}`,document.getElementById("gajiStatus").textContent=`Status: ${d.status}`,openModal(allModals.gaji),t.reset()},1500)):(showLoader(!1),showToast("Email atau Nomor WhatsApp tidak ditemukan.","error"))});
        document.getElementById('withdrawBtn').addEventListener('click', () => { closeModal(allModals.gaji); if (currentUser) { setTimeout(() => { openModal(allModals.withdraw); }, 300);}});
        document.getElementById('withdrawForm').addEventListener('submit', (e) => { e.preventDefault(); const t=document.getElementById("wdFullName").value,a=document.getElementById("wdAccountNumber").value,l=document.getElementById("wdBankName").value,d=SALARIES[currentUser.status]||0;const o=`*-- PENGAJUAN WITHDRAW BARU --*\n\n*💰 JUMLAH: $${d}*\n\nHalo Admin Payment Zen, Saya ingin mengajukan penarikan dana:\n\n*👤 DETAIL KLIEN:*\n*Email:* ${currentUser.email}\n*WhatsApp:* ${currentUser.whatsapp}\n*Status Akun:* ${currentUser.status}\n\n*🏦 DETAIL PEMBAYARAN:*\n*Bank:* ${l}\n*No. Rekening:* ${a}\n*Atas Nama:* ${t}\n\nMohon untuk segera diproses. Terima kasih!`;window.open(`https://wa.me/${ADMIN_WHATSAPP}?text=${encodeURIComponent(o)}`,"_blank"),closeModal(allModals.withdraw),showToast("Pengajuan Anda dialihkan ke WhatsApp...","success"),document.getElementById("withdrawForm").reset()});
        document.getElementById('infoBtn').addEventListener('click', () => openModal(allModals.info));
        document.getElementById('bulkAddBtn').addEventListener('click', () => openModal(allModals.bulkAdd));
        document.getElementById('bulkAddForm').addEventListener('submit', async (e) => { e.preventDefault(); const bulkData = document.getElementById('bulkData').value; const bulkStatus = document.getElementById('bulkStatus').value; const lines = bulkData.split('\n').filter(line => line.trim() !== ''); const newUsers = lines.map((line, index) => { const parts = line.trim().split(/\s+/); if (parts.length < 2) return null; return { id: `${Date.now()}-${index}`, email: parts[0], whatsapp: parts[1], status: bulkStatus, claimed: false }; }).filter(Boolean); if (newUsers.length === 0) { showToast('Tidak ada data valid untuk ditambahkan.', 'error'); return; } const updatedUsers = [...users, ...newUsers]; if (await updateData(updatedUsers)) { showToast(`${newUsers.length} pengguna berhasil ditambahkan.`, 'success'); closeModal(allModals.bulkAdd); e.target.reset(); }});
        Object.values(allModals).forEach(m=>{if(!m.id.includes("toast")&&!m.id.includes("loader")){const e=m.id.replace("Modal",""),t=document.getElementById(`${e}CloseBtn`)||document.getElementById(`${e}CancelBtn`)||document.getElementById(`${e}LaterBtn`);m.addEventListener("click",e=>e.target===m&&closeModal(m)),t&&t.addEventListener("click",()=>closeModal(m))}});
        document.getElementById('adminAccessBtn').addEventListener('click', () => openModal(allModals.admin)); document.getElementById('adminCodeForm').addEventListener('submit', (e) => { e.preventDefault(); const i=document.getElementById('adminCodeInput'); if(i.value===ADMIN_CODE){closeModal(allModals.admin);showView('admin');fetchData().then(renderTable)}else{document.getElementById('adminError').textContent='Kode salah.'; i.value='';}});
        document.getElementById('confirmOkBtn').addEventListener('click', () => { if(confirmCallback) confirmCallback(); closeModal(allModals.confirm); }); document.getElementById('logoutBtn').addEventListener('click', () => showView('login'));
        document.getElementById('adminForm').addEventListener('submit', async(e)=>{e.preventDefault();const t=document.getElementById("userId").value,a={email:document.getElementById("formEmail").value,whatsapp:document.getElementById("formWhatsapp").value,status:document.getElementById("formStatus").value},l=t?users.map(e=>e.id===t?{...e,...a}:e):[...users,{...a,id:Date.now().toString(),claimed:!1}];await updateData(l)&&(showToast(`Data berhasil ${t?"diperbarui":"ditambahkan"}.`),resetAdminForm())});
        document.getElementById('cancelBtn').addEventListener('click', resetAdminForm);
        document.getElementById('userTableBody').addEventListener('click',async(e)=>{const t=e.target,a=t.dataset.id||t.closest("[data-id]")?.dataset.id;if(a){if(t.classList.contains("edit-btn")){const e=users.find(e=>e.id===a);e&&(document.getElementById("userId").value=e.id,document.getElementById("formEmail").value=e.email,document.getElementById("formWhatsapp").value=e.whatsapp,document.getElementById("formStatus").value=e.status,document.getElementById("formTitle").textContent="Edit Pengguna",document.getElementById("saveBtn").textContent="Update",document.getElementById("cancelBtn").classList.remove("hidden"),window.scrollTo(0,0))}if(t.classList.contains("delete-btn"))showConfirmModal("Yakin ingin hapus pengguna ini?",async()=>{await updateData(users.filter(e=>e.id!==a))&&showToast("Pengguna dihapus.")});if(t.classList.contains("toggle-claim")){const e=users.map(e=>e.id===a?{...e,claimed:t.checked}:e);await updateData(e)||!t.checked}}});
    });
    </script>
</body>
</html>

