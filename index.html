<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rent By Zen</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <style>
        /* Reset dan Pengaturan Dasar Halaman */
        body {
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 0; 
            box-sizing: border-box;
            overflow: hidden;
        }
        /* "Bingkai HP" */
        .app-container {
            width: 100%;
            height: 100svh; 
            border-radius: 0;
            box-shadow: none;
            overflow: hidden;
            position: relative;
        }

        /* --- KEYFRAMES ANIMASI --- */
        @keyframes fadeInSlideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeInSlideUpCard {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes cardBounceIn {
            0% { transform: scale(0.5); opacity: 0; }
            80% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes shine-text {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }
        @keyframes pulse-blue {
            0% { box-shadow: 0 0 0 0 rgba(68, 119, 248, 0.7); transform: scale(1); }
            70% { box-shadow: 0 0 0 15px rgba(68, 119, 248, 0); transform: scale(1.02); }
            100% { box-shadow: 0 0 0 0 rgba(68, 119, 248, 0); transform: scale(1); }
        }

        /* Gaya Umum untuk setiap "Layar" */
        .screen {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            box-sizing: border-box;
            background-color: #ffffff;
            transition: opacity 0.4s ease, transform 0.4s ease;
            transform: translateY(0);
            opacity: 1;
        }
        .screen.hidden { 
            opacity: 0;
            transform: translateY(10px);
            pointer-events: none;
            z-index: -1; 
        } 
        .screen.grey-bg { background-color: #f0f2f5; }
        .screen.dark-overlay { background-color: rgba(0, 0, 0, 0.5); }
        .screen.gradient-bg { background: linear-gradient(135deg, #7c4dff, #4477f8); }

        /* --- Layar 1: Splash Screen --- */
        .splash-screen {
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 42px;
            font-weight: 800;
            z-index: 2;
            padding: 20px;
        }
        .splash-screen h1 { 
            margin: 0; 
            text-align: center; 
            font-size: 42px; 
            line-height: 1.2;
            opacity: 0;
            animation: fadeInSlideUp 0.8s ease-out 0.3s forwards;
        }
        #continue-btn { 
            background-color: #ffffff; 
            color: #4477f8; 
            border: none; 
            padding: 16px 50px; 
            border-radius: 50px; 
            font-size: 18px; 
            font-weight: 700; 
            cursor: pointer; 
            margin-top: 80px; 
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInSlideUp 0.6s ease-out 1s forwards;
            transition: transform 0.1s ease-out, box-shadow 0.1s ease-out;
        }
        #continue-btn:active {
            transform: translateY(20px) scale(0.98); 
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        /* --- Layar 2: Login Screen (UPDATED) --- */
        .login-screen {
            padding: 40px 30px;
            display: flex;
            flex-direction: column;
            z-index: 1;
            overflow-y: auto;
        }
        
        /* --- LOGO & BANNER CONTAINER BARU --- */
        .header-logo-container {
            display: flex;
            align-items: center; /* Supaya logo dan banner sejajar vertikal */
            gap: 15px; /* Jarak antara logo dan banner */
            margin-top: 20px;
            margin-bottom: 30px;
        }
        .linkedin-logo { 
            /* Margin dihapus karena sudah diatur parent container */
            display: block;
        }
        .header-banner-img {
            height: 50px; /* Sesuaikan tinggi banner biar imbang sama logo */
            width: auto;
            border-radius: 8px;
            object-fit: contain;
        }

        /* Typography Branding */
        .login-screen .welcome-title { 
            font-size: 38px; 
            font-weight: 900; /* Extra Bold */
            color: #1a1a1a; 
            margin-top: 10px; 
            margin-bottom: 40px;
            letter-spacing: -1px;
            line-height: 1.1;
        }
        .login-screen .welcome-title .by-zen { 
            color: #4477f8; 
            font-style: italic;
            display: inline-block;
            position: relative;
        }
        .login-screen .welcome-title .by-zen::after {
            content: '';
            position: absolute;
            bottom: 2px;
            left: 0;
            width: 100%;
            height: 4px;
            background-color: rgba(68, 119, 248, 0.2);
            border-radius: 2px;
        }

        .login-form { width: 100%; }
        .form-group { margin-bottom: 25px; }
        .form-group label { 
            font-size: 14px; 
            color: #555; 
            display: block; 
            margin-bottom: 8px; 
            font-weight: 700; 
            margin-left: 4px;
        }
        
        .input-group { position: relative; }
        
        .input-icon { 
            position: absolute; 
            left: 18px; 
            top: 50%; 
            transform: translateY(-50%); 
            color: #9ca3af; 
            font-size: 22px; 
            transition: color 0.3s ease;
            z-index: 2;
        }
        .input-group:focus-within .input-icon {
            color: #4477f8; 
        }

        .input-field { 
            width: 100%; 
            border: 2px solid #f3f4f6; 
            background-color: #ffffff; 
            border-radius: 12px; 
            padding: 16px 16px 16px 55px; 
            font-size: 16px; 
            color: #1f2937; 
            box-sizing: border-box; 
            font-family: 'Nunito', sans-serif; 
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .input-field:focus {
            border-color: #4477f8;
            background-color: #fff;
            box-shadow: 0 0 0 4px rgba(68, 119, 248, 0.15);
            outline: none;
        }
        .input-field::placeholder {
            color: #9ca3af;
            font-weight: 400;
        }
        .input-field[readonly] { background-color: #f9fafb; color: #6b7280; border-color: #e5e7eb; }
        
        .sign-in-btn { 
            width: 100%; 
            background-color: #4477f8; 
            color: white; 
            border: none; 
            padding: 16px; 
            border-radius: 12px; 
            font-size: 18px; 
            font-weight: 800; 
            cursor: pointer; 
            margin-top: 20px; 
            box-shadow: 0 10px 20px rgba(68, 119, 248, 0.2); 
            transition: all 0.2s ease-out;
            position: relative; 
            overflow: hidden; 
        }
        .sign-in-btn:active {
            transform: scale(0.98);
            box-shadow: 0 5px 10px rgba(68, 119, 248, 0.3);
        }
        .sign-in-btn:disabled { background-color: #aaa; cursor: not-allowed; box-shadow: none; }

        .btn-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 0.8s linear infinite;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        .sign-in-btn.loading .btn-spinner { opacity: 1; }
        .sign-in-btn.loading span { opacity: 0; }

        .illustration-placeholder { width: 100%; margin-top: auto; min-height: 50px; padding-bottom: 20px; }
        .admin-fab { position: absolute; bottom: 30px; left: 30px; width: 50px; height: 50px; background-color: #4477f8; color: white; border: none; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); cursor: pointer; z-index: 10; }
        .admin-fab .material-symbols-outlined { font-size: 24px; color: white; }
        
        /* --- Layar 3: Loading Screen --- */
        #loading-screen { 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            background: rgba(255, 255, 255, 0.95); 
            color: #333; z-index: 3; 
            font-size: 18px; 
            font-weight: 600; 
        }
        .spinner { width: 50px; height: 50px; border: 5px solid #f0f0f0; border-top: 5px solid #4477f8; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* --- Layar 4: Reward Screen --- */
        #reward-screen { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            z-index: 4; 
            padding: 30px;
            position: relative;
        }
        #reward-screen.show { opacity: 1; pointer-events: auto; }
        #confetti-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
        
        .reward-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 300px;
            position: relative;
            z-index: 2;
            opacity: 0; 
        }
        #reward-screen.show .reward-card { 
            animation: cardBounceIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        #admin-prompt-screen.show .reward-card {
            opacity: 0; 
            animation: cardBounceIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .icon-background {
            width: 100px;
            height: 100px;
            margin: 0 auto 10px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 193, 7, 0.4), rgba(255, 193, 7, 0.1) 50%, transparent 70%);
            display: flex;
            align-items: center;
            justify-content: center;
            animation: shine-pulse 2s infinite 0.5s;
        }
        .reward-icon { font-size: 60px; color: #ffc107; }
        .reward-card h2 { margin-top: 0; color: #4477f8; font-size: 24px; font-weight: 800; }
        .reward-card p { font-size: 16px; color: #333; margin-bottom: 20px; }
        
        .reward-voucher-card {
            background: linear-gradient(to right, #bdbdbd, #fafafa, #bdbdbd);
            border-radius: 12px;
            padding: 20px;
            color: #222;
            text-align: left;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            position: relative;
            margin-bottom: 30px;
            border: 1px solid rgba(0,0,0,0.1);
        }
        .card-chip {
            font-size: 36px;
            color: #ffc107;
            opacity: 0.8;
            animation: holographic-shine 4s infinite linear;
        }
        .card-amount {
            font-size: 24px;
            font-weight: 600;
            margin-top: 10px;
            color: #222;
        }
        
        .card-amount span {
            font-size: 30px;
            font-weight: 900;
            letter-spacing: 1px;
            background: linear-gradient(to right, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
            background-size: 200% auto;
            animation: shine-text 3s linear infinite;
            display: inline-block;
        }

        .card-label {
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            color: #333;
            opacity: 0.7;
            margin-top: 20px;
        }
        
        #withdraw-btn { 
            background-color: #4477f8; 
            color: white; 
            border: none; 
            padding: 16px; 
            border-radius: 10px; 
            font-size: 16px; 
            font-weight: 700; 
            cursor: pointer; 
            margin-top: 15px; 
            width: 100%; 
            transition: transform 0.1s ease; 
            box-shadow: 0 0 0 0 rgba(68, 119, 248, 0.7);
            animation: pulse-blue 2s infinite;
        }
        #withdraw-btn:active {
            transform: scale(0.98);
            animation: none; 
            box-shadow: 0 2px 8px rgba(68, 119, 248, 0.4);
        }
        
        #close-reward-link { display: inline-block; margin-top: 15px; color: #888; font-size: 14px; font-weight: 600; cursor: pointer; text-decoration: none; }
        

        /* --- LAYAR 5: ADMIN SCREEN --- */
        .admin-screen {
            z-index: 5;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .admin-header { 
            background-color: #ffffff; 
            color: #333; 
            padding: 15px 20px; 
            display: flex; 
            align-items: center; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.08); 
            position: relative; 
            flex-shrink: 0; 
        }
        .admin-header h2 { margin: 0; font-size: 20px; text-align: center; flex-grow: 1; font-weight: 700; }
        .admin-back-btn { 
            background: none; 
            border: none; 
            color: #333; 
            font-size: 28px; 
            font-weight: bold; 
            cursor: pointer; 
            padding: 0 10px; 
            position: absolute; 
            left: 10px; 
        }
        .admin-body { padding: 20px; overflow-y: auto; flex-grow: 1; }
        .admin-controls { 
            display: flex; 
            flex-direction: column; 
            gap: 20px; 
            margin-bottom: 20px; 
            padding: 20px; 
            background: #fff; 
            border-radius: 12px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.05); 
        }
        .admin-controls label { display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #555; }
        
        .admin-controls select, .admin-controls input[type="text"] {
            width: 100%;
            padding: 12px 15px; 
            border: 2px solid transparent; 
            border-radius: 8px; 
            box-sizing: border-box;
            font-family: 'Nunito', sans-serif;
            background-color: #f0f2f5; 
            font-weight: 600;
            transition: all 0.2s ease;
        }
        .admin-controls select:focus, .admin-controls input[type="text"]:focus {
            background-color: #fff;
            border-color: #4477f8; 
        }
        
        .admin-controls textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid transparent;
            border-radius: 8px;
            box-sizing: border-box;
            font-family: 'Nunito', sans-serif;
            background-color: #f0f2f5;
            font-weight: 600;
            min-height: 100px;
            resize: vertical;
            margin-bottom: 10px;
        }
        .admin-controls textarea:focus {
            background-color: #fff;
            border-color: #4477f8; 
        }
        
        .mass-action-btns {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .btn-warning { background-color: #ffc107; color: #000; }
        .btn-danger { background-color: #dc3545; color: white; }
        .btn-info { background-color: #17a2b8; color: white; }
        
        .admin-btn-small {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            font-size: 13px;
        }
        .admin-btn-small:disabled { background-color: #ccc; color: #666; cursor: not-allowed; }


        #bulk-save-btn { width: 100%; padding: 12px; margin-top: 5px; background: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 700; }
        #bulk-save-btn:disabled { background: #aaa; cursor: not-allowed; }
        #admin-data-container { background: none; border: none; max-height: none; overflow-y: visible; }
        
        .user-card { 
            background: #fff; 
            border: none; 
            border-radius: 12px; 
            padding: 20px; 
            margin-bottom: 15px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInSlideUpCard 0.4s ease-out forwards;
        }
        .user-card h3 { 
            margin-top: 0; 
            margin-bottom: 15px; 
            color: #111; 
            font-size: 18px; 
            word-break: break-all; 
            font-weight: 700; 
        }
        .user-card-item { 
            margin-bottom: 8px; 
            font-size: 14px; 
            display: flex; 
            align-items: center; 
        }
        .user-card-item strong { 
            color: #666; 
            width: 90px; 
            min-width: 90px; 
            display: inline-block; 
            font-weight: 600; 
        }
        .user-card-item span { 
            word-break: break-all; 
            font-weight: 500; 
            color: #111; 
        }

        .claim-status {
            font-weight: 700;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 12px;
            text-transform: uppercase;
        }
        .claim-status.claimed {
            background-color: #e0f2f1; 
            color: #00796b; 
        }
        .claim-status.not-claimed {
            background-color: #f1f1f1; 
            color: #555; 
        }

        .toggle-claim-btn {
            border: none;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 700;
            color: white;
            cursor: pointer;
            transition: background-color 0.2s, opacity 0.2s;
            margin-left: auto; 
        }
        .toggle-claim-btn.success {
            background-color: #28a745; 
        }
        .toggle-claim-btn.success:hover {
            background-color: #218838;
        }
        .toggle-claim-btn.danger {
            background-color: #dc3545; 
        }
        .toggle-claim-btn.danger:hover {
            background-color: #c82333;
        }
        .toggle-claim-btn:disabled {
            background-color: #aaa;
            opacity: 0.7;
            cursor: not-allowed;
        }


        .reward-input-group { 
            margin-top: 15px; 
            border-top: 1px solid #eee; 
            padding-top: 15px; 
            display: flex; 
            gap: 10px; 
        }
        .reward-input { 
            flex-grow: 1; 
            border: 1px solid #ddd; 
            padding: 8px 12px; 
            border-radius: 8px; 
            font-size: 14px; 
            font-family: 'Nunito', sans-serif; 
            background: #f0f2f5; 
        }
        .save-reward-btn { 
            padding: 8px 12px; 
            background: #28a745; 
            color: white; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 14px; 
            font-weight: 700; 
            transition: background-color 0.2s;
        }
        .save-reward-btn:hover:not(:disabled) {
            background: #218838;
        }
        .save-reward-btn:disabled { background: #aaa; }


        /* --- LAYAR 6: WITHDRAW SCREEN --- */
        .withdraw-screen {
            z-index: 6;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .withdraw-screen .admin-body {
            padding-bottom: 120px; 
        }
        
        #withdraw-form { padding: 0; }
        
        .withdraw-screen .admin-header {
            background-color: #fff; 
            color: #000; 
        }
        .withdraw-screen .admin-back-btn {
            color: #000; 
        }
        
        .form-card {
            background: #fff;
            border-radius: 12px;
            padding: 5px 25px 20px 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .form-card h3 {
            font-size: 18px;
            font-weight: 800;
            color: #4477f8;
            margin-bottom: 25px;
        }
        
        .payment-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        .payment-option {
            border: 2px solid #f0f2f5;
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            font-weight: 700;
            font-size: 14px;
            color: #555;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: #fff;
        }
        .payment-option:hover {
            border-color: #d1d9e6;
        }
        .payment-option.selected {
            border-color: #4477f8;
            background-color: #eef3ff;
            color: #4477f8;
        }

        #manual-bank-container {
            margin-top: 10px;
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        #manual-bank-container.visible {
            opacity: 1;
            max-height: 60px; 
        }

        .withdraw-screen .input-group {
            margin-bottom: 25px;
        }
        .withdraw-screen .input-icon {
            left: 0; 
            font-size: 20px;
        }
        .withdraw-screen .input-field {
            background: transparent;
            border: none;
            border-bottom: 2px solid #ddd;
            border-radius: 0;
            padding-left: 35px; 
            padding-right: 0;
            padding-bottom: 10px;
            font-weight: 600;
            font-size: 16px;
            width: 100%;
            box-sizing: border-box;
            font-family: 'Nunito', sans-serif;
        }
        .withdraw-screen .input-field:focus {
            border-bottom-color: #4477f8;
            outline: none;
        }
        .withdraw-screen .form-group label {
            font-size: 14px;
            font-weight: 700;
            color: #555;
            margin-bottom: 5px;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .info-item:last-child {
            border-bottom: none;
        }
        .info-item span { 
            font-size: 14px;
            color: #555;
            font-weight: 600;
        }
        .info-item strong { 
            font-size: 14px;
            font-weight: 700;
            color: #000;
        }
        
        .withdraw-cta-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 20px 30px;
            background: #fff;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.05);
            border-top: 1px solid #f0f0f0;
            box-sizing: border-box;
        }
        #withdraw-submit-btn { 
            width: 100%; 
            background-color: #28a745; 
            color: white; border: none; 
            padding: 16px; 
            border-radius: 10px; 
            font-size: 18px; 
            font-weight: 700; 
            cursor: pointer; 
            margin-top: 0; 
            transition: all 0.15s ease-out;
            position: relative; /* Untuk spinner */
            overflow: hidden; /* Sembunyikan spinner */
        }
        #withdraw-submit-btn:active {
            transform: scale(0.98);
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.4);
        }
        /* EFEK BARU: Spinner di tombol Withdraw */
        #withdraw-submit-btn.loading .btn-spinner {
            opacity: 1;
        }
        #withdraw-submit-btn.loading span { /* Sembunyikan teks */
            opacity: 0;
        }

        /* --- GAYA TOAST/POP UP --- */
        #toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .toast-message { padding: 12px 20px; color: white; font-weight: 600; border-radius: 25px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); opacity: 0; transform: translateY(-30px); animation: slideIn 0.3s ease-out forwards; }
        .toast-message.error { background-color: #d9534f; }
        .toast-message.success { background-color: #28a745; }
        @keyframes slideIn { to { opacity: 1; transform: translateY(0); } }
        .toast-message.hide { animation: fadeOut 0.5s ease-in forwards; }
        @keyframes fadeOut { to { opacity: 0; transform: translateY(-10px); } }
        
        /* --- TAMBAHAN CSS: Input Sandi Admin --- */
        .admin-pass-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #f0f2f5;
            border-radius: 8px;
            box-sizing: border-box;
            font-family: 'Nunito', sans-serif;
            background-color: #f0f2f5;
            font-weight: 600;
            transition: all 0.2s ease;
            text-align: center;
        }
        .admin-pass-input:focus {
            background-color: #fff;
            border-color: #4477f8;
        }
        
    </style>
</head>
<body>
    <div class="app-container">
        <div id="toast-container"></div>
        <div id="splash-screen" class="screen gradient-bg splash-screen">
            <h1>Yoo... PAYMENT DAY!!!</h1>
            <button id="continue-btn">Lanjutkan</button>
        </div>
        <div id="login-screen" class="screen login-screen hidden">
            <div class="header-logo-container">
                <svg class="linkedin-logo" xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 60 60" fill="none">
                    <rect width="60" height="60" rx="12" fill="#0A66C2"/>
                    <path d="M50.1 49.5H41.6V35.6C41.6 32 41.5 27.5 36.6 27.5C31.6 27.5 30.9 31.4 30.9 35.4V49.5H22.4V23H30.6V26.4H30.7C31.8 24.4 34.6 22.5 39.8 22.5C48.4 22.5 50.1 28.5 50.1 34.2V49.5Z" fill="white"/>
                    <path d="M18.1 49.5H9.6V23H18.1V49.5Z" fill="white"/>
                    <path d="M13.8 19C11.1 19 9 16.9 9 14.2C9 11.5 11.1 9.4 13.8 9.4C16.5 9.4 18.6 11.5 18.6 14.2C18.6 16.9 16.5 19 13.8 19Z" fill="white"/>
                </svg>
                <img src="baner.gif" alt="Promo Banner" class="header-banner-img">
            </div>
            
            <h1 class="welcome-title">Rent <span class="by-zen">By Zen</span></h1>
            
            <form class="login-form" id="login-form">
                <div class="form-group">
                    <label for="email">Email Linkedin</label>
                    <div class="input-group">
                        <span class="input-icon material-symbols-outlined">mail</span>
                        <input type="email" id="email" class="input-field" placeholder="Masukkan email Linkedin Anda" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="whatsapp">No WhatsApp</label>
                    <div class="input-group">
                        <span class="input-icon material-symbols-outlined">call</span>
                        <input type="tel" id="whatsapp" class="input-field" placeholder="Masukkan No WhatsApp Anda" required>
                    </div>
                </div>
                <button type="submit" class="sign-in-btn" id="sign-in-btn">
                    <span>Masuk</span>
                    <div class="btn-spinner"></div> </button>
            </form>
            <div class="illustration-placeholder"></div>
            <button id="admin-btn" class="admin-fab">
                <span class="material-symbols-outlined">settings</span>
            </button>
        </div>

        <div id="admin-prompt-screen" class="screen dark-overlay hidden">
            <div class="reward-card"> 
                <h2 style="color: #4477f8;">Mode Admin</h2>
                <p>Silakan masukkan sandi untuk melanjutkan.</p>
                <form id="admin-pass-form">
                    <div class="form-group" style="margin-bottom: 15px;">
                        <input type="password" id="admin-pass-input" class="admin-pass-input" required placeholder="Sandi...">
                    </div>
                    <button type="submit" class="sign-in-btn" style="margin-top: 0; width: 100%;">
                        <span>Masuk</span>
                        <div class="btn-spinner"></div>
                    </button>
                    <a id="admin-pass-cancel" style="display: block; margin-top: 15px; color: #888; font-size: 14px; font-weight: 600; cursor: pointer; text-decoration: none;">Batal</a>
                </form>
            </div>
        </div>

        <div id="loading-screen" class="screen hidden">
            <div class="spinner"></div>
            <p>Menghitung Reward...</p>
        </div>
        <div id="reward-screen" class="screen dark-overlay hidden">
            <canvas id="confetti-canvas"></canvas>
            <div class="reward-card">
                <div class="icon-background">
                    <span class="material-symbols-outlined reward-icon">
                        workspace_premium
                    </span>
                </div>
                <h2>Reward Anda!</h2>
                <p>Selamat, Anda mendapatkan:</p>
                <div class="reward-voucher-card">
                    <span class="material-symbols-outlined card-chip">sim_card</span>
                    <div class="card-amount">
                        Rp <span id="reward-amount-span">0</span>
                    </div>
                    <div class="card-label">Platinum Reward</div>
                </div>
                <button id="withdraw-btn">Withdraw</button>
                <a id="close-reward-link">Tutup</a>
            </div>
        </div>
        
        <div id="admin-screen" class="screen grey-bg admin-screen hidden">
            <div class="admin-header">
                <button id="admin-back-btn" class="admin-back-btn">&lt;</button>
                <h2>Admin Panel</h2>
            </div>
            <div class="admin-body">
                <div class="admin-controls">
                    <div class="filter-group">
                        <label for="status-filter">Filter Status:</label>
                        <select id="status-filter">
                            <option value="all">Semua Status</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="search-email-input">Cari Email:</label>
                        <input type="text" id="search-email-input" placeholder="Ketik email untuk mencari...">
                    </div>
                    
                    <div class="bulk-reward-group">
                        <label for="bulk-reward-input">Bulk Reward (untuk status terfilter):</label>
                        <input type="text" id="bulk-reward-input" placeholder="Set reward...">
                        <button id="bulk-save-btn" disabled>Simpan untuk Status Terfilter</button>
                        
                        <div style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px;">
                            <label style="margin-bottom: 8px; display: block;">Global Actions (Semua User):</label>
                            <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                                <button id="reset-all-reward-btn" class="admin-btn-small btn-danger">Reset Reward 0</button>
                                <button id="global-set-unclaimed-btn" class="admin-btn-small btn-warning">Set Semua "Belum Claim"</button>
                                <button id="global-set-claimed-btn" class="admin-btn-small btn-info">Set Semua "Claimed"</button>
                            </div>
                        </div>

                    </div>
                </div>

                <div class="admin-controls">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                        <label style="margin: 0;">Identifikasi Email Massal:</label>
                        <button id="mass-clear-input-btn" style="background: none; border: none; color: #dc3545; cursor: pointer; font-weight: bold; font-size: 12px; display: flex; align-items: center;">
                            <span class="material-symbols-outlined" style="font-size: 16px; margin-right: 2px;">close</span> Hapus Input
                        </button>
                    </div>
                    <p style="font-size: 12px; color: #666; margin-top: 0; margin-bottom: 5px;">Paste daftar email (satu per baris) di bawah ini:</p>
                    <textarea id="mass-email-input" placeholder="email1@gmail.com&#10;email2@gmail.com&#10;..."></textarea>
                    <button id="mass-check-btn" class="admin-btn-small btn-info" style="width: 100%;">Identifikasi</button>
                    
                    <div id="mass-result-info" style="margin-top: 10px; font-size: 13px; font-weight: 600; display: none;">
                        Ditemukan: <span id="found-count" style="color: green;">0</span> | Tidak ditemukan: <span id="not-found-count" style="color: red;">0</span>
                    </div>

                    <div class="mass-action-btns">
                        <button id="mass-set-claimed-btn" class="admin-btn-small btn-warning" disabled>Set Claimed</button>
                        <button id="mass-set-unclaimed-btn" class="admin-btn-small btn-danger" disabled>Set Belum Claim</button>
                    </div>
                </div>

                <div id="admin-data-container">Memuat data...</div>
            </div>
        </div>
        <div id="withdraw-screen" class="screen grey-bg withdraw-screen hidden">
            <div class="admin-header"> <button id="withdraw-back-btn" class="admin-back-btn">&lt;</button>
                <h2>Penarikan</h2>
            </div>
            
            <div class="admin-body"> <form id="withdraw-form">
                
                <div class="form-group" style="display: none;">
                    <input type="text" id="wd-total" class="input-field" readonly>
                    <input type="tel" id="wd-whatsapp" class="input-field" readonly>
                    <input type="email" id="wd-email" class="input-field" readonly>
                    <input type="hidden" id="wd-bank-final" required>
                </div>
                
                <div class="form-card">
                    <h3>Tujuan Transfer</h3>
                    
                    <div class="form-group">
                        <label for="wd-nama">Atas Nama</label>
                        <div class="input-group">
                            <span class="input-icon material-symbols-outlined">person</span>
                            <input type="text" id="wd-nama" class="input-field" placeholder="Mis: Budi Santoso" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Metode Transfer</label>
                        <div class="payment-grid">
                            <div class="payment-option" data-value="BCA" data-type="bank">BCA</div>
                            <div class="payment-option" data-value="MANDIRI" data-type="bank">Mandiri</div>
                            <div class="payment-option" data-value="BRI" data-type="bank">BRI</div>
                            <div class="payment-option" data-value="BNI" data-type="bank">BNI</div>
                            
                            <div class="payment-option" data-value="DANA" data-type="ewallet">DANA</div>
                            <div class="payment-option" data-value="GOPAY" data-type="ewallet">GoPay</div>
                            <div class="payment-option" data-value="OVO" data-type="ewallet">OVO</div>
                            <div class="payment-option" data-value="SHOPEEPAY" data-type="ewallet">ShopeePay</div>
                            
                            <div class="payment-option" data-value="LAINNYA" data-type="other" style="grid-column: span 2;">Lainnya</div>
                        </div>
                        
                        <div id="manual-bank-container">
                            <input type="text" id="wd-bank-manual" class="input-field" placeholder="Ketik Nama Bank/E-Wallet...">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="wd-rekening" id="label-rekening">No. Rekening</label>
                         <div class="input-group">
                            <span class="input-icon material-symbols-outlined">pin</span>
                            <input type="number" id="wd-rekening" class="input-field" placeholder="0123456789" required>
                        </div>
                    </div>
                </div>
                
                <div class="form-card">
                    <h3>Detail Reward</h3>
                    <div class="info-item">
                        <span>Total Reward</span>
                        <strong id="wd-total-display">Rp 0</strong>
                    </div>
                    <div class="info-item">
                        <span>Email</span>
                        <strong id="wd-email-display">-</strong>
                    </div>
                    <div class="info-item">
                        <span>No. WhatsApp</span>
                        <strong id="wd-wa-display">-</strong>
                    </div>
                </div>
                
            </form>
        </div>
            
            <div class="withdraw-cta-container">
                <button type="submit" id="withdraw-submit-btn" form="withdraw-form">
                    <span>Ajukan Withdraw</span>
                    <div class="btn-spinner"></div> </button>
            </div>
        </div>
    </div>
    
    <script>
        // --- KONFIGURASI JSONBIN ---
        const BIN_ID = '6905803fae596e708f3baa25';
        const API_KEY = '$2a$10$4v5UzmjJBEf7T6RUlR7CfeJERCrf/waXNcO7pxUk3OYGOzBNLJ7Fy';
        
        const API_URL_READ = `https://api.jsonbin.io/v3/b/${BIN_ID}/latest`;
        const API_URL_WRITE = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
        let globalBinRecord = null;
        let currentUser = null;
        let massIdentifiedUsers = []; // Untuk menyimpan user yg ditemukan via mass tool
        
        // --- Seleksi Elemen ---
        document.addEventListener('DOMContentLoaded', function() {
            // (Layar Utama)
            const splash = document.getElementById('splash-screen');
            const login = document.getElementById('login-screen');
            const continueBtn = document.getElementById('continue-btn');
            const loginForm = document.getElementById('login-form');
            const emailInput = document.getElementById('email');
            const whatsappInput = document.getElementById('whatsapp');
            const signInBtn = document.getElementById('sign-in-btn');
            const loadingScreen = document.getElementById('loading-screen');
            const toastContainer = document.getElementById('toast-container');
            
            // (Layar Reward)
            const rewardScreen = document.getElementById('reward-screen');
            const rewardAmountSpan = document.getElementById('reward-amount-span');
            const withdrawBtn = document.getElementById('withdraw-btn');
            const closeRewardLink = document.getElementById('close-reward-link');
            
            // (Layar Admin)
            const adminBtn = document.getElementById('admin-btn');
            const adminScreen = document.getElementById('admin-screen');
            const adminBackBtn = document.getElementById('admin-back-btn');
            const adminDataContainer = document.getElementById('admin-data-container');
            const statusFilter = document.getElementById('status-filter');
            const bulkRewardInput = document.getElementById('bulk-reward-input');
            const bulkSaveBtn = document.getElementById('bulk-save-btn');
            const searchEmailInput = document.getElementById('search-email-input');
            // Elemen Admin Baru
            const resetAllRewardBtn = document.getElementById('reset-all-reward-btn');
            const globalSetUnclaimedBtn = document.getElementById('global-set-unclaimed-btn');
            const globalSetClaimedBtn = document.getElementById('global-set-claimed-btn');

            const massEmailInput = document.getElementById('mass-email-input');
            const massCheckBtn = document.getElementById('mass-check-btn');
            const massResultInfo = document.getElementById('mass-result-info');
            const foundCountSpan = document.getElementById('found-count');
            const notFoundCountSpan = document.getElementById('not-found-count');
            const massSetClaimedBtn = document.getElementById('mass-set-claimed-btn');
            const massSetUnclaimedBtn = document.getElementById('mass-set-unclaimed-btn');
            // Elemen Hapus Input
            const massClearInputBtn = document.getElementById('mass-clear-input-btn');
            
            const adminPromptScreen = document.getElementById('admin-prompt-screen');
            const adminPassForm = document.getElementById('admin-pass-form');
            const adminPassInput = document.getElementById('admin-pass-input');
            const adminPassCancel = document.getElementById('admin-pass-cancel');
            
            // (Layar Withdraw)
            const withdrawScreen = document.getElementById('withdraw-screen');
            const withdrawBackBtn = document.getElementById('withdraw-back-btn');
            const withdrawForm = document.getElementById('withdraw-form');
            const withdrawSubmitBtn = document.getElementById('withdraw-submit-btn'); 
            const wdTotalDisplay = document.getElementById('wd-total-display');
            const wdEmailDisplay = document.getElementById('wd-email-display');
            const wdWaDisplay = document.getElementById('wd-wa-display');
            // Elemen Withdraw Baru
            const paymentOptions = document.querySelectorAll('.payment-option');
            const manualBankContainer = document.getElementById('manual-bank-container');
            const manualBankInput = document.getElementById('wd-bank-manual');
            const finalBankInput = document.getElementById('wd-bank-final');
            const labelRekening = document.getElementById('label-rekening');

            
            // --- Logika Confetti ---
            const confettiCanvas = document.getElementById('confetti-canvas');
            const myConfetti = confetti.create(confettiCanvas, {
                resize: true,
                useWorker: true
            });
            function fireConfetti() {
                const count = 200;
                const defaults = { origin: { y: 0.7 } };
                function fire(particleRatio, opts) {
                    myConfetti(Object.assign({}, defaults, opts, {
                        particleCount: Math.floor(count * particleRatio)
                    }));
                }
                fire(0.25, { spread: 26, startVelocity: 55 });
                fire(0.2, { spread: 60 });
                fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
                fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
                fire(0.1, { spread: 120, startVelocity: 45 });
            }
            // --- Navigasi Splash ke Login ---
            continueBtn.addEventListener('click', function() {
                splash.classList.add('hidden');
                login.classList.remove('hidden');
            });
            // --- Normalisasi Nomor Telepon ---
            function normalizePhone(phoneStr) {
                if (!phoneStr) return "";
                let normalized = phoneStr.trim().replace(/\s/g, '');
                if (normalized.startsWith('+62')) { return '0' + normalized.substring(3); }
                if (normalized.startsWith('62')) { return '0' + normalized.substring(2); }
                return normalized;
            }
            // --- Fungsi untuk MEMBACA data dari JSONBin ---
            async function fetchJsonBinData(containerForLoading) {
                if (containerForLoading === 'login') {
                    setLoading(true); 
                } else if (containerForLoading === 'admin') {
                    adminDataContainer.innerHTML = 'Memuat data...';
                }
                
                try {
                    const response = await fetch(API_URL_READ, { headers: { 'X-Master-Key': API_KEY } });
                    if (!response.ok) throw new Error(`Gagal mengambil data: ${response.statusText}`);
                    const data = await response.json();
                    globalBinRecord = data.record;
                    return globalBinRecord;
                } catch (error) {
                    console.error('Error fetching data:', error);
                    if (containerForLoading === 'login') { showMessage(error.message, 'error'); }
                    else if (containerForLoading === 'admin') { adminDataContainer.innerHTML = 'Gagal memuat data.'; }
                    return null;
                } finally {
                    if (containerForLoading === 'login') { setLoading(false); }
                }
            }
            
            // --- FUNGSI UNTUK MENULIS data ke JSONBin ---
            async function updateJsonBinData(fullRecordData) {
                try {
                    const response = await fetch(API_URL_WRITE, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json', 'X-Master-Key': API_KEY },
                        body: JSON.stringify(fullRecordData)
                    });
                    if (!response.ok) throw new Error(`Gagal menyimpan data: ${response.statusText}`);
                    globalBinRecord = fullRecordData;
                    return true;
                } catch (error) {
                    console.error('Error updating data:', error);
                    alert(`Error: ${error.message}`);
                    return false;
                }
            }
            
            // --- Logika Login ---
            loginForm.addEventListener('submit', async function(event) {
                event.preventDefault(); 
                const email = emailInput.value.toLowerCase();
                const inputPhone = normalizePhone(whatsappInput.value);
                const data = await fetchJsonBinData('login');
                
                if (!data || !data.users) {
                    showMessage('Gagal memuat data pengguna.', 'error');
                    return;
                }
                
                const foundUser = data.users.find(user => {
                    const dbPhone = normalizePhone(user.telepon);
                    return user.email.toLowerCase() === email && dbPhone === inputPhone; 
                });
                
                if (foundUser) {

                    if (foundUser.claim_status && foundUser.claim_status === 'claimed') {
                        showMessage('Sudah di Claim!', 'error');
                        setLoading(false); 
                        return; 
                    }

                    const rewardValue = foundUser.reward;
                    if (rewardValue && rewardValue.trim() !== "" && rewardValue !== "0") {
                        currentUser = foundUser; 
                        
                        login.classList.add('hidden');
                        loadingScreen.classList.remove('hidden');
                        
                        animateCountUp(rewardAmountSpan, parseFloat(rewardValue), 1000);

                        setTimeout(() => {
                            loadingScreen.classList.add('hidden');
                            
                            const formattedReward = new Intl.NumberFormat('id-ID').format(rewardValue);
                            
                            document.getElementById('wd-total').value = `Rp ${formattedReward}`;
                            document.getElementById('wd-whatsapp').value = currentUser.telepon;
                            document.getElementById('wd-email').value = currentUser.email;
                            
                            wdTotalDisplay.textContent = `Rp ${formattedReward}`;
                            wdEmailDisplay.textContent = currentUser.email;
                            wdWaDisplay.textContent = currentUser.telepon;
                            
                            rewardScreen.classList.remove('hidden');
                            setTimeout(() => {
                                rewardScreen.classList.add('show');
                                fireConfetti();
                            }, 10);
                            
                        }, 2500);
                        
                    } else {
                        showMessage('Email anda tidak masuk dalam List Payment atau reward 0', 'error');
                    }
                    
                } else {
                    showMessage('Email atau No WhatsApp salah.', 'error');
                }
            });
            
            // --- Tombol di Layar Reward ---
            closeRewardLink.addEventListener('click', function() {
                rewardScreen.classList.remove('show');
                rewardScreen.classList.add('hidden'); // Jalankan animasi keluar
                login.classList.remove('hidden'); // Jalankan animasi masuk
                
                setTimeout(() => {
                    emailInput.value = '';
                    whatsappInput.value = '';
                    signInBtn.disabled = false;
                }, 400); 
            });
            
            withdrawBtn.addEventListener('click', function() {
                rewardScreen.classList.remove('show');
                rewardScreen.classList.add('hidden');
                withdrawScreen.classList.remove('hidden');
            });

            // --- Tombol di Layar Withdraw ---
            withdrawBackBtn.addEventListener('click', function() {
                withdrawScreen.classList.add('hidden');
                rewardScreen.classList.remove('hidden');
                setTimeout(() => {
                    rewardScreen.classList.add('show');
                }, 10);
            });

            // --- LOGIKA PEMILIHAN BANK (Baru) ---
            paymentOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // 1. Reset kelas 'selected' dari semua opsi
                    paymentOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // 2. Tambah kelas 'selected' ke yang diklik
                    this.classList.add('selected');
                    
                    const value = this.getAttribute('data-value');
                    const type = this.getAttribute('data-type');
                    
                    // 3. Atur input hidden
                    if (value === 'LAINNYA') {
                        manualBankContainer.classList.add('visible');
                        finalBankInput.value = ""; // Akan diisi dari input manual
                        labelRekening.textContent = "No. Rekening / E-Wallet";
                    } else {
                        manualBankContainer.classList.remove('visible');
                        manualBankInput.value = ""; // Bersihkan input manual
                        finalBankInput.value = value;
                        
                        // 4. Ubah Label
                        if (type === 'ewallet') {
                            labelRekening.textContent = "Nomor HP";
                        } else {
                            labelRekening.textContent = "No. Rekening";
                        }
                    }
                });
            });
            
            withdrawForm.addEventListener('submit', async function(event) {
                event.preventDefault();
                
                // VALIDASI BANK
                let bankName = finalBankInput.value;
                
                // Cek apakah user memilih 'LAINNYA' (cek dari kelas selected)
                const selectedOption = document.querySelector('.payment-option.selected');
                if (!selectedOption) {
                    showMessage('Pilih metode transfer dulu!', 'error');
                    return;
                }
                
                if (selectedOption.getAttribute('data-value') === 'LAINNYA') {
                    bankName = manualBankInput.value.trim();
                    if (!bankName) {
                        showMessage('Isi nama bank/e-wallet manual!', 'error');
                        manualBankInput.focus();
                        return;
                    }
                }

                withdrawSubmitBtn.disabled = true;
                withdrawSubmitBtn.classList.add('loading');

                try {
                    if (!currentUser || !globalBinRecord || !globalBinRecord.users) {
                        throw new Error('Data pengguna tidak ditemukan. Silakan login ulang.');
                    }
                    
                    const userIndex = globalBinRecord.users.findIndex(u => u.id === currentUser.id);
                    if (userIndex === -1) {
                        throw new Error('Gagal menemukan data user di record global.');
                    }
                    
                    globalBinRecord.users[userIndex].claim_status = 'claimed';
                    
                    const updateSuccess = await updateJsonBinData(globalBinRecord);
                    
                    if (!updateSuccess) {
                        throw new Error('Gagal menyimpan status claim ke server.');
                    }

                    const nama = document.getElementById('wd-nama').value;
                    // Gunakan bankName yang sudah divalidasi di atas
                    const rekening = document.getElementById('wd-rekening').value;
                    const total = document.getElementById('wd-total').value;
                    const whatsapp = document.getElementById('wd-whatsapp').value;
                    const email = document.getElementById('wd-email').value;
                    
                    const message = `Halo, saya ingin mengajukan permintaan Withdraw.
*Detail Akun:*
Email: ${email}
No. WA: ${whatsapp}
Total Reward: ${total}
*Tujuan Transfer:*
Atas Nama: ${nama}
Metode: ${bankName}
No. Rekening/HP: ${rekening}
Terima kasih.`;
                    
                    const encodedMessage = encodeURIComponent(message);
                    const waURL = `https://wa.me/6289513304878?text=${encodedMessage}`;
                    
                    window.open(waURL, '_blank');
                    
                    withdrawScreen.classList.add('hidden');
                    login.classList.remove('hidden');
                    
                    setTimeout(() => {
                        emailInput.value = '';
                        whatsappInput.value = '';
                        document.getElementById('wd-nama').value = '';
                        document.getElementById('wd-rekening').value = '';
                        // Reset pilihan bank
                        paymentOptions.forEach(opt => opt.classList.remove('selected'));
                        manualBankContainer.classList.remove('visible');
                        manualBankInput.value = '';
                        finalBankInput.value = '';
                    }, 400);
                    
                    currentUser = null;

                } catch (error) {
                    console.error('Error during withdraw submission:', error);
                    showMessage(error.message || 'Gagal memproses withdraw.', 'error');
                
                } finally {
                    withdrawSubmitBtn.disabled = false;
                    withdrawSubmitBtn.classList.remove('loading');
                }
            });

            // --- Logika Admin ---
            
            adminBtn.addEventListener('click', function(event) {
                event.preventDefault();
                adminPromptScreen.classList.remove('hidden');
                setTimeout(() => { 
                    adminPromptScreen.classList.add('show'); 
                    adminPassInput.focus();
                }, 10);
            });

            adminPassCancel.addEventListener('click', function() {
                adminPromptScreen.classList.remove('show');
                adminPromptScreen.classList.add('hidden');
                setTimeout(() => {
                    adminPassInput.value = ''; 
                }, 400);
            });

            adminPassForm.addEventListener('submit', async function(event) {
                event.preventDefault();
                const password = adminPassInput.value;
                const passBtn = adminPassForm.querySelector('.sign-in-btn');
                
                if (password === '2003') {
                    passBtn.classList.add('loading');
                    passBtn.disabled = true;

                    const data = await fetchJsonBinData('admin'); 

                    adminPromptScreen.classList.remove('show');
                    adminPromptScreen.classList.add('hidden');
                    login.classList.add('hidden');
                    adminScreen.classList.remove('hidden'); 

                    setTimeout(() => {
                        adminPassInput.value = '';
                        passBtn.classList.remove('loading');
                        passBtn.disabled = false;
                    }, 400);

                    if (data && data.users) {
                        populateStatusFilter(data.users);
                        displayAdminCards(data.users);
                    }
                } else {
                    showMessage('Sandi salah!', 'error');
                    adminPassInput.value = '';
                    adminPassInput.focus();
                }
            });

            
            function populateStatusFilter(users) {
                statusFilter.innerHTML = '<option value="all">Semua Status</option>';
                const statuses = [...new Set(users.map(u => u.status || 'N/A'))];
                statuses.sort().forEach(status => {
                    const option = document.createElement('option');
                    option.value = status;
                    option.textContent = status;
                    statusFilter.appendChild(option);
                });
            }
            
            function displayAdminCards(users) {
                adminDataContainer.innerHTML = '';
                if (!users || users.length === 0) {
                    adminDataContainer.innerHTML = '<p>Tidak ada data pengguna.</p>';
                    return;
                }
                
                users.forEach((user, index) => { 
                    const card = document.createElement('div');
                    card.className = 'user-card';
                    const status = user.status || 'N/A';
                    card.dataset.status = status;
                    const catatan = user.catatan || user['catatan '] || 'N/A';
                    const reward = user.reward || '';
                    
                    const isClaimed = user.claim_status === 'claimed';
                    const claimStatus = isClaimed ? 'claimed' : 'Belum Claim';
                    const claimClass = isClaimed ? 'claimed' : 'not-claimed';
                    const buttonText = isClaimed ? 'Batalkan' : 'Tandai Claim';
                    const buttonClass = isClaimed ? 'toggle-claim-btn danger' : 'toggle-claim-btn success';
                    
                    card.innerHTML = `
                        <h3>${user.email || 'Email tidak ada'}</h3>
                        <p class="user-card-item"><strong>Telepon:</strong> <span>${user.telepon || 'N/A'}</span></p>
                        <p class="user-card-item"><strong>Status:</strong> <span>${status}</span></p>
                        
                        <p class="user-card-item">
                            <strong>Claim:</strong> 
                            <span class="claim-status ${claimClass}">${claimStatus}</span>
                            <button class="${buttonClass}" data-user-id="${user.id}">${buttonText}</button>
                        </p>

                        <p class="user-card-item"><strong>Tanggal:</strong> <span>${user.tanggal || 'N/A'}</span></p>
                        <p class="user-card-item"><strong>Catatan:</strong> <span>${catatan}</span></p>
                        <div class="reward-input-group">
                            <input type="text" class="reward-input" placeholder="Set Reward..." value="${reward}" data-user-id="${user.id}">
                            <button class="save-reward-btn" data-user-id="${user.id}">Save</button>
                        </div>
                    `;
                    
                    card.style.animationDelay = `${index * 0.05}s`;
                    
                    adminDataContainer.appendChild(card);
                });
            }

            
            adminBackBtn.addEventListener('click', function() {
                adminScreen.classList.add('hidden');
                login.classList.remove('hidden');
                setTimeout(() => {
                    statusFilter.value = 'all';
                    bulkRewardInput.value = '';
                    bulkSaveBtn.disabled = true;
                    searchEmailInput.value = '';
                    massEmailInput.value = '';
                    massResultInfo.style.display = 'none';
                    massSetClaimedBtn.disabled = true;
                    massSetUnclaimedBtn.disabled = true;
                }, 400);
            });
            
            function filterAdminView() {
                const selectedStatus = statusFilter.value;
                const searchQuery = searchEmailInput.value.toLowerCase().trim();
                const allCards = adminDataContainer.querySelectorAll('.user-card');
                
                bulkSaveBtn.disabled = (selectedStatus === 'all');
                
                allCards.forEach(card => {
                    const cardStatus = card.dataset.status;
                    const cardEmail = card.querySelector('h3').textContent.toLowerCase();
                    
                    const statusMatch = (selectedStatus === 'all' || cardStatus === selectedStatus);
                    const searchMatch = cardEmail.includes(searchQuery);
                    
                    if (statusMatch && searchMatch) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            }

            statusFilter.addEventListener('change', filterAdminView);
            searchEmailInput.addEventListener('input', filterAdminView);
            
            // --- FITUR: Reset Semua Reward (Global) ---
            resetAllRewardBtn.addEventListener('click', async function() {
                if (!confirm('PERINGATAN: Ini akan menghapus reward SEMUA user (menjadi 0). Apakah Anda yakin?')) {
                    return;
                }
                
                this.disabled = true;
                this.textContent = 'Resetting...';
                
                // Update semua user di memory
                globalBinRecord.users.forEach(user => {
                    user.reward = "0";
                });
                
                const success = await updateJsonBinData(globalBinRecord);
                
                if (success) {
                    filterAdminView(); 
                    displayAdminCards(globalBinRecord.users);
                    filterAdminView(); // Apply filter again
                    alert('Semua reward berhasil di-reset!');
                } else {
                    alert('Gagal mereset reward.');
                }
                
                this.disabled = false;
                this.textContent = 'Reset Reward 0';
            });

             // --- FITUR BARU: Global Set Unclaimed ---
             globalSetUnclaimedBtn.addEventListener('click', async function() {
                if (!confirm('PERINGATAN: Anda akan mengubah status SEMUA user menjadi "Belum Claim". Lanjutkan?')) {
                    return;
                }
                
                this.disabled = true;
                this.textContent = 'Processing...';
                
                globalBinRecord.users.forEach(user => {
                    user.claim_status = ''; // Kosongkan status
                });
                
                const success = await updateJsonBinData(globalBinRecord);
                
                if (success) {
                    filterAdminView(); 
                    displayAdminCards(globalBinRecord.users);
                    filterAdminView();
                    alert('Berhasil mereset semua status ke "Belum Claim".');
                } else {
                    alert('Gagal mengubah status.');
                }
                
                this.disabled = false;
                this.textContent = 'Set Semua "Belum Claim"';
            });

            // --- FITUR BARU: Global Set Claimed ---
            globalSetClaimedBtn.addEventListener('click', async function() {
                if (!confirm('PERINGATAN: Anda akan mengubah status SEMUA user menjadi "Claimed". Lanjutkan?')) {
                    return;
                }
                
                this.disabled = true;
                this.textContent = 'Processing...';
                
                globalBinRecord.users.forEach(user => {
                    user.claim_status = 'claimed';
                });
                
                const success = await updateJsonBinData(globalBinRecord);
                
                if (success) {
                    filterAdminView(); 
                    displayAdminCards(globalBinRecord.users);
                    filterAdminView();
                    alert('Berhasil mengubah semua status ke "Claimed".');
                } else {
                    alert('Gagal mengubah status.');
                }
                
                this.disabled = false;
                this.textContent = 'Set Semua "Claimed"';
            });

            // --- FITUR: Hapus Input (Tombol X) ---
            massClearInputBtn.addEventListener('click', function() {
                massEmailInput.value = '';
                massResultInfo.style.display = 'none';
                massSetClaimedBtn.disabled = true;
                massSetUnclaimedBtn.disabled = true;
                massIdentifiedUsers = [];
            });

            // --- FITUR: Mass Email Check ---
            massCheckBtn.addEventListener('click', function() {
                const rawText = massEmailInput.value;
                if (!rawText.trim()) {
                    alert('Silakan tempel daftar email terlebih dahulu.');
                    return;
                }

                // Pisahkan per baris, trim, lowercase, dan filter yang kosong
                const inputEmails = rawText.split(/\r?\n/).map(e => e.trim().toLowerCase()).filter(e => e);
                
                massIdentifiedUsers = [];
                let notFoundCount = 0;
                let foundCount = 0;
                
                // Cari kecocokan di globalBinRecord
                if (globalBinRecord && globalBinRecord.users) {
                    // Untuk setiap email input, cek apakah ada di DB
                    // Menggunakan filter agar jika ada duplikat di input tetap terhitung, 
                    // tapi lebih baik kita cari usernya saja.
                    
                    // Cara 1: Cari user yang emailnya ada di input list
                    massIdentifiedUsers = globalBinRecord.users.filter(user => 
                        inputEmails.includes(user.email.toLowerCase())
                    );
                    
                    foundCount = massIdentifiedUsers.length;
                    notFoundCount = inputEmails.length - foundCount; // Estimasi kasar (asumsi input unik)
                }

                // Update UI
                foundCountSpan.textContent = foundCount;
                notFoundCountSpan.textContent = notFoundCount >= 0 ? notFoundCount : 0;
                massResultInfo.style.display = 'block';

                if (foundCount > 0) {
                    massSetClaimedBtn.disabled = false;
                    massSetUnclaimedBtn.disabled = false;
                } else {
                    massSetClaimedBtn.disabled = true;
                    massSetUnclaimedBtn.disabled = true;
                }
            });

            // --- FITUR: Mass Set Status ---
            async function handleMassStatusChange(newStatus) {
                if (massIdentifiedUsers.length === 0) return;
                
                const actionName = newStatus === 'claimed' ? 'Claimed' : 'Belum Claim';
                if (!confirm(`Ubah status ${massIdentifiedUsers.length} user yang teridentifikasi menjadi "${actionName}"?`)) {
                    return;
                }

                // Disable buttons
                massSetClaimedBtn.disabled = true;
                massSetUnclaimedBtn.disabled = true;

                // Update data di memory globalBinRecord
                // Kita harus update object asli di globalBinRecord, bukan copy di massIdentifiedUsers
                massIdentifiedUsers.forEach(identifiedUser => {
                    const originalUser = globalBinRecord.users.find(u => u.id === identifiedUser.id);
                    if (originalUser) {
                        originalUser.claim_status = newStatus;
                    }
                });

                // Simpan ke server
                const success = await updateJsonBinData(globalBinRecord);

                if (success) {
                    displayAdminCards(globalBinRecord.users); // Refresh UI kartu
                    filterAdminView(); // Apply filter search/status jika ada
                    alert(`Berhasil mengubah status masal ke: ${actionName}`);
                } else {
                    alert('Gagal menyimpan perubahan masal.');
                }

                // Enable buttons kembali
                massSetClaimedBtn.disabled = false;
                massSetUnclaimedBtn.disabled = false;
            }

            massSetClaimedBtn.addEventListener('click', () => handleMassStatusChange('claimed'));
            massSetUnclaimedBtn.addEventListener('click', () => handleMassStatusChange(''));


            // --- Existing Bulk Save Logic ---
            bulkSaveBtn.addEventListener('click', async function() {
                const statusToUpdate = statusFilter.value;
                const rewardValue = bulkRewardInput.value;
                if (statusToUpdate === 'all') { /* ... (validasi) ... */ }
                if (!rewardValue) { /* ... (validasi) ... */ }
                
                const usersToUpdate = globalBinRecord.users.filter(u => (u.status || 'N/A') === statusToUpdate);
                if (!confirm(`Anda yakin ingin mengatur reward "${rewardValue}" untuk ${usersToUpdate.length} pengguna...?`)) {
                    return;
                }
                
                this.disabled = true;
                this.textContent = 'Saving...';
                
                globalBinRecord.users.forEach(user => {
                    if ((user.status || 'N/A') === statusToUpdate) {
                        user.reward = rewardValue;
                    }
                });
                
                const success = await updateJsonBinData(globalBinRecord);
                
                if (success) {
                    bulkRewardInput.value = '';
                    statusFilter.value = 'all';
                    filterAdminView(); 
                    displayAdminCards(globalBinRecord.users);
                    filterAdminView();
                    
                    this.textContent = 'Simpan untuk Status Terfilter';
                    this.disabled = true;
                } else {
                    alert('Gagal menyimpan. Cek console.');
                    this.disabled = false;
                    this.textContent = 'Simpan untuk Status Terfilter';
                }
            });
            
            adminDataContainer.addEventListener('click', async function(event) {
                
                if (event.target.classList.contains('save-reward-btn')) {
                    const saveButton = event.target;
                    const userId = saveButton.dataset.userId;
                    const inputField = adminDataContainer.querySelector(`.reward-input[data-user-id="${userId}"]`);
                    const newReward = inputField.value;
                    
                    saveButton.disabled = true;
                    saveButton.textContent = 'Saving...';
                    
                    const userToUpdate = globalBinRecord.users.find(u => u.id === userId);
                    if (userToUpdate) { userToUpdate.reward = newReward; }
                    
                    const success = await updateJsonBinData(globalBinRecord);
                    
                    if (success) {
                        saveButton.textContent = 'Saved!';
                        saveButton.style.backgroundColor = '#17a2b8';
                        setTimeout(() => {
                            saveButton.disabled = false;
                            saveButton.textContent = 'Save';
                            saveButton.style.backgroundColor = '#28a745';
                        }, 2000);
                    } else {
                        alert('Gagal menyimpan. Cek console.');
                        saveButton.disabled = false;
                        saveButton.textContent = 'Save';
                    }
                }

                if (event.target.classList.contains('toggle-claim-btn')) {
                    const toggleButton = event.target;
                    const userId = toggleButton.dataset.userId;

                    toggleButton.disabled = true;
                    toggleButton.textContent = '...';

                    try {
                        const userToUpdate = globalBinRecord.users.find(u => u.id === userId);
                        if (!userToUpdate) throw new Error('User not found');

                        const wasClaimed = userToUpdate.claim_status === 'claimed';
                        const newStatus = wasClaimed ? '' : 'claimed'; 
                        userToUpdate.claim_status = newStatus;

                        const success = await updateJsonBinData(globalBinRecord);
                        if (!success) throw new Error('Failed to save to server');

                        const card = toggleButton.closest('.user-card');
                        const statusSpan = card.querySelector('.claim-status');
                        
                        if (newStatus === 'claimed') {
                            statusSpan.textContent = 'claimed';
                            statusSpan.className = 'claim-status claimed';
                            toggleButton.textContent = 'Batalkan';
                            toggleButton.className = 'toggle-claim-btn danger';
                        } else {
                            statusSpan.textContent = 'Belum Claim';
                            statusSpan.className = 'claim-status not-claimed';
                            toggleButton.textContent = 'Tandai Claim';
                            toggleButton.className = 'toggle-claim-btn success';
                        }

                    } catch (error) {
                        console.error('Error toggling claim status:', error);
                        showMessage('Gagal update status', 'error');
                    } finally {
                        toggleButton.disabled = false;
                    }
                }
            });

            // --- Fungsi Bantuan (Helper) ---

            function setLoading(isLoading) {
                signInBtn.disabled = isLoading;
                if (isLoading) {
                    signInBtn.classList.add('loading');
                } else {
                    signInBtn.classList.remove('loading');
                }
            }
            
            function showMessage(message, type = 'error') {
                const toast = document.createElement('div');
                toast.className = `toast-message ${type}`;
                toast.textContent = message;
                
                toastContainer.appendChild(toast);
                
                setTimeout(() => {
                    toast.classList.add('hide');
                }, 3000);
                
                setTimeout(() => {
                    toast.remove();
                }, 3500);
            }

            function animateCountUp(el, to, duration = 1500) {
                let start = 0;
                const end = to;
                let startTime = null;

                function animation(currentTime) {
                    if (startTime === null) startTime = currentTime;
                    const timeElapsed = currentTime - startTime;
                    const progress = Math.min(timeElapsed / duration, 1);
                    
                    const easedProgress = 1 - Math.pow(1 - progress, 3);
                    
                    let currentValue = Math.floor(easedProgress * (end - start) + start);
                    el.textContent = new Intl.NumberFormat('id-ID').format(currentValue);
                    
                    if (timeElapsed < duration) {
                        requestAnimationFrame(animation);
                    } else {
                        el.textContent = new Intl.NumberFormat('id-ID').format(end);
                    }
                }
                
                requestAnimationFrame(animation);
            }
            
        });
    </script>
</body>
                    </html>
